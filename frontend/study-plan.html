<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ | FMS Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    :root {
      --purple:#6B3FA0;--purple-dark:#4A2870;--purple-light:#F3EEFF;--purple-mid:#E8DEFF;
      --accent:#9B6DD1;--bg:#F7F5FA;--white:#FFFFFF;--text:#181117;--text-sub:#64748B;
      --border:#EDE8F5;--red:#EF4444;--red-bg:#FEE2E2;--sidebar-w:240px;--topbar-h:64px;
      --radius:12px;--shadow:0 1px 3px rgba(0,0,0,0.07),0 1px 2px rgba(0,0,0,0.04);
      --shadow-md:0 4px 12px rgba(107,63,160,0.10);
    }
    .sidebar-qa {
      width:var(--sidebar-w);background:var(--white);height:100vh;position:fixed;
      left:0;top:0;display:flex;flex-direction:column;border-right:1px solid var(--border-col);z-index:100;
    }
    .sidebar-brand{padding:20px 20px 16px;border-bottom:1px solid var(--border-col);}
    .sidebar-brand-title{font-family:'Lexend',sans-serif;font-size:16px;font-weight:700;color:var(--text-main);letter-spacing:-0.2px;}
    .sidebar-brand-sub{font-size:11.5px;color:var(--purple);font-weight:500;margin-top:2px;}
    .sidebar-section-label{padding:20px 20px 6px;font-size:10px;font-weight:700;color:var(--text-sub);text-transform:uppercase;letter-spacing:1.2px;}
    .sidebar-nav-qa{flex:1;padding:8px 12px;display:flex;flex-direction:column;gap:2px;overflow-y:auto;}
    .nav-item-qa{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:8px;
      font-size:13.5px;font-weight:500;color:var(--text-sub);
      text-decoration:none;transition:all 0.18s;cursor:pointer;user-select:none;
    }
    .nav-item-qa:hover{background:var(--purple-light);color:var(--purple);}
    .nav-item-qa.active{background:var(--purple-light);color:var(--purple);font-weight:600;}
    .nav-icon-qa{width:18px;height:18px;flex-shrink:0;opacity:0.75;}
    .nav-item-qa.active .nav-icon-qa,.nav-item-qa:hover .nav-icon-qa{opacity:1;}
    .sidebar-footer-qa{padding:12px;border-top:1px solid var(--border-col);}
    .sidebar-footer-qa .nav-item-qa{color:var(--red);}
    .sidebar-footer-qa .nav-item-qa:hover{background:var(--red-bg);color:#DC2626;}


*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Noto Sans Thai','Segoe UI',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh}



/* MAIN */
.main{margin-left:var(--sidebar-w);flex:1;display:flex;flex-direction:column;min-width:0}

/* Topbar */
.topbar{background:var(--white);border-bottom:1px solid var(--border);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10}
.topbar-title{font-size:16px;font-weight:700}
.topbar-right{display:flex;align-items:center;gap:12px}
.search-box{display:flex;align-items:center;gap:8px;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:7px 12px;width:220px}
.search-box input{border:none;background:none;outline:none;font-size:13px;color:var(--text);font-family:inherit;width:100%}
.search-box input::placeholder{color:var(--muted)}
.notif-btn{width:34px;height:34px;border-radius:8px;background:var(--bg);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;font-size:16px}
.notif-dot{position:absolute;top:5px;right:5px;width:7px;height:7px;border-radius:50%;background:var(--red);border:1.5px solid white}

/* Content */
.content{padding:28px;display:flex;gap:20px;flex:1;min-height:0}
.panel-left{flex:1;min-width:0}
.breadcrumb{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted);margin-bottom:16px}
.breadcrumb a{color:var(--purple);text-decoration:none;cursor:pointer}
.page-heading{font-size:26px;font-weight:700;margin-bottom:4px}
.page-sub{font-size:14px;color:var(--muted);margin-bottom:24px}
.toolbar{display:flex;align-items:center;gap:10px;margin-bottom:16px}
.toolbar-search{display:flex;align-items:center;gap:8px;background:var(--white);border:1px solid var(--border);border-radius:10px;padding:9px 14px;flex:1}
.toolbar-search:focus-within{border-color:var(--purple)}
.toolbar-search input{border:none;background:none;outline:none;font-size:14px;font-family:inherit;color:var(--text);width:100%}
.toolbar-search input::placeholder{color:var(--muted)}
.filter-select{padding:9px 28px 9px 12px;border-radius:10px;border:1px solid var(--border);background:var(--white);font-size:13px;font-family:inherit;color:var(--text);cursor:pointer;outline:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238b8fa8'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center}

/* Table */
.table-card{background:var(--white);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.table-header{display:grid;grid-template-columns:2fr 2fr 80px;padding:12px 20px;background:var(--bg);border-bottom:1px solid var(--border);font-size:12px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.table-row{display:grid;grid-template-columns:2fr 2fr 80px;padding:14px 20px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .12s;align-items:center}
.table-row:last-child{border-bottom:none}
.table-row:hover{background:var(--purple-light)}
.table-row.selected{background:var(--purple-light)}
.major-name{font-weight:600;font-size:14px}
.major-en{font-size:12px;color:var(--muted);margin-top:2px}
.action-group{display:flex;gap:4px}
.icon-btn{width:30px;height:30px;border-radius:7px;background:none;border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;transition:all .12s;color:var(--muted)}
.icon-btn:hover.edit{background:var(--purple-light);border-color:var(--purple);color:var(--purple)}
.table-footer{padding:12px 20px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;font-size:13px;color:var(--muted)}
.pagination{display:flex;gap:4px}
.page-btn{width:30px;height:30px;border-radius:7px;border:1px solid var(--border);background:none;cursor:pointer;font-size:13px;font-family:inherit;display:flex;align-items:center;justify-content:center;transition:all .12s}
.page-btn:hover{background:var(--purple-light);border-color:var(--purple);color:var(--purple)}
.page-btn.active{background:var(--purple);color:white;border-color:var(--purple)}

/* Right panel */
.panel-right{width:500px;display:none;flex-direction:column;gap:0;flex-shrink:0}
.panel-right.open{display:flex}
.detail-card{background:var(--white);border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column;max-height:calc(100vh - 120px);position:sticky;top:88px}
.detail-header{padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-shrink:0}
.detail-title{font-size:17px;font-weight:700;line-height:1.3}
.detail-sub{font-size:12px;color:var(--muted);margin-top:3px}
.detail-meta{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;align-items:center}
.meta-chip{padding:3px 10px;border-radius:999px;background:var(--purple-light);color:var(--purple);font-size:12px;font-weight:600}
.close-btn{width:28px;height:28px;border-radius:6px;background:var(--bg);border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--muted);flex-shrink:0;transition:all .12s}
.close-btn:hover{background:var(--red-bg);color:var(--red);border-color:var(--red)}

.year-tabs{display:flex;gap:6px;padding:12px 20px;border-bottom:1px solid var(--border);background:var(--bg);flex-shrink:0}
.year-tab{padding:6px 14px;border-radius:8px;border:1px solid var(--border);background:var(--white);font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;color:var(--muted);transition:all .15s}
.year-tab:hover{background:var(--purple-light);color:var(--purple);border-color:var(--purple)}
.year-tab.active{background:var(--purple);color:white;border-color:var(--purple)}
.plan-section{padding:16px 20px;overflow-y:auto;flex:1}
.plan-section-title{font-size:12px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.add-sem-btn{display:flex;align-items:center;gap:4px;padding:4px 10px;background:var(--purple-light);color:var(--purple);border:none;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:background .12s}
.add-sem-btn:hover{background:var(--purple-mid)}
.semester-block{border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:10px}
.semester-head{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--bg);border-bottom:1px solid var(--border);cursor:pointer;user-select:none}
.semester-head-left{display:flex;align-items:center;gap:8px}
.semester-name{font-size:14px;font-weight:700}
.credits-badge{font-size:12px;color:var(--muted)}
.chevron{font-size:11px;color:var(--muted);transition:transform .2s}
.semester-block.collapsed .chevron{transform:rotate(-90deg)}
.semester-block.collapsed .semester-body{display:none}
.subject-row{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--border);transition:background .1s}
.subject-row:last-child{border-bottom:none}
.subject-row:hover{background:var(--purple-light)}
.subject-code{font-size:12px;font-weight:700;color:var(--purple);margin-bottom:2px}
.subject-name{font-size:13px;font-weight:500}
.subject-cat{font-size:11px;color:var(--muted)}
.subject-credits{font-size:13px;font-weight:700;white-space:nowrap}
.subject-del{width:24px;height:24px;border-radius:5px;background:none;border:none;cursor:pointer;font-size:13px;color:var(--muted);transition:all .1s;display:flex;align-items:center;justify-content:center;margin-left:6px}
.subject-del:hover{background:var(--red-bg);color:var(--red)}
.add-subject-row{padding:8px 14px;border-top:1px dashed var(--border)}
.add-subject-btn{display:flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:8px;border:1.5px dashed var(--border);border-radius:8px;background:none;color:var(--muted);font-size:13px;font-family:inherit;cursor:pointer;transition:all .15s}
.add-subject-btn:hover{border-color:var(--purple);color:var(--purple);background:var(--purple-light)}

/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(15,10,40,.5);backdrop-filter:blur(6px);z-index:200;display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex}
.modal{background:var(--white);border-radius:20px;width:100%;max-width:780px;max-height:90vh;overflow-y:auto;box-shadow:0 32px 80px rgba(0,0,0,.22);display:flex;flex-direction:column}
.modal-header{padding:24px 28px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:white;z-index:1;border-radius:20px 20px 0 0}
.modal-title{font-size:20px;font-weight:700}
.modal-close{width:32px;height:32px;border-radius:8px;background:var(--bg);border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;color:var(--muted);transition:all .12s}
.modal-close:hover{background:var(--red-bg);color:var(--red);border-color:var(--red)}
.modal-body{padding:24px 28px;display:flex;flex-direction:column;gap:0}
.section-label{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;margin-top:20px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.section-label:first-child{margin-top:0}
.field{margin-bottom:14px}
.field label{display:block;font-size:13px;font-weight:600;color:#555;margin-bottom:6px}
.field input,.field select,.field textarea{width:100%;padding:11px 14px;border:1.5px solid var(--border);border-radius:10px;background:var(--bg);font-size:14px;font-family:inherit;color:var(--text);outline:none;transition:all .15s}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--purple);background:white;box-shadow:0 0 0 3px rgba(108,77,246,.1)}
.field textarea{resize:vertical;min-height:90px;line-height:1.6}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.field-row-3{display:grid;grid-template-columns:2fr 1fr 1fr;gap:14px}
.modal-footer{padding:16px 28px 24px;display:flex;gap:10px;justify-content:flex-end;border-top:1px solid var(--border);position:sticky;bottom:0;background:white;border-radius:0 0 20px 20px}
.btn-cancel{padding:10px 20px;border-radius:10px;background:var(--bg);border:1.5px solid var(--border);font-size:14px;font-family:inherit;cursor:pointer;color:var(--text);font-weight:500;transition:background .12s}
.btn-cancel:hover{background:var(--border)}
.btn-save{padding:10px 24px;border-radius:10px;background:var(--purple);color:white;border:none;font-size:14px;font-weight:700;font-family:inherit;cursor:pointer;transition:background .12s;box-shadow:0 4px 12px rgba(108,77,246,.3)}
.btn-save:hover{background:#5a3dd8}

.empty-state{text-align:center;padding:40px 20px;color:var(--muted)}
.empty-state .icon{font-size:36px;margin-bottom:10px}
.empty-state p{font-size:14px;line-height:1.6}
.loading{text-align:center;padding:40px;color:var(--muted);font-size:14px}
.toast{position:fixed;bottom:24px;right:24px;background:var(--text);color:white;padding:12px 20px;border-radius:12px;font-size:14px;z-index:999;transform:translateY(80px);opacity:0;transition:all .3s;font-weight:500}
.toast.show{transform:translateY(0);opacity:1}
.toast.success{background:#16a34a}
.toast.error{background:var(--red)}
</style>
</head>
<body>
<aside class="sidebar-qa">
  <div class="sidebar-brand"><div class="sidebar-brand-title">FMS Admin</div><div class="sidebar-brand-sub">PSU Faculty of Management</div></div>
  <div class="sidebar-section-label">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</div>
  <nav class="sidebar-nav-qa">
    <a class="nav-item-qa" href="dashboard.html"><svg class="nav-icon-qa" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"/></svg>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
    <a class="nav-item-qa active" href="study-plan.html"><svg class="nav-icon-qa" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/></svg>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</a>
    <a class="nav-item-qa" href="course-list.html"><svg class="nav-icon-qa" viewBox="0 0 20 20" fill="currentColor"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/></svg>‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</a>
    <a class="nav-item-qa" href="qa-dashboard.html"><svg class="nav-icon-qa" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</a></nav>
  <div class="sidebar-footer-qa"><a class="nav-item-qa" href="login.html" id="logoutBtn"><svg class="nav-icon-qa" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/></svg>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></div>
</aside>

<!-- MAIN -->
<div class="main">
  <header class="topbar">
    <div class="topbar-title">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (Study Plan)</div>
    <div class="topbar-right">
      <div class="search-box">
        <span>üîç</span>
        <input type="text" id="topSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤..." />
      </div>
      <div class="notif-btn">üîî<div class="notif-dot"></div></div>
    </div>
  </header>

  <div class="content">
    <!-- Left -->
    <div class="panel-left">
      <div class="breadcrumb">
        <a onclick="window.location.href='dashboard.html'">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
        <span>/</span><span>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
      </div>
      <h1 class="page-heading">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h1>
      <p class="page-sub">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏•‡∏î ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</p>

      <div class="toolbar">
        <div class="toolbar-search">
          <span style="color:var(--muted)">üîç</span>
          <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤..." />
        </div>
        <select class="filter-select" id="courseFilter">
          <option value="">‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        </select>
      </div>

      <div class="table-card">
        <div class="table-header">
          <div>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</div>
          <div>‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</div>
          <div>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</div>
        </div>
        <div id="majorTableBody"><div class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
        <div class="table-footer">
          <span id="footerInfo">-</span>
          <div class="pagination" id="pagination"></div>
        </div>
      </div>
    </div>

    <!-- Right -->
    <div class="panel-right" id="rightPanel">
      <div class="detail-card">
        <div class="detail-header">
          <div style="flex:1">
            <div class="detail-title" id="detailTitle">-</div>
            <div class="detail-sub" id="detailSub">-</div>
            <div class="detail-meta">
              <span class="meta-chip" id="detailCourse">-</span>
            </div>
          </div>
          <button class="close-btn" id="closePanel">‚úï</button>
        </div>
        <div class="year-tabs" id="yearTabs">
          <button class="year-tab active" data-year="1" onclick="selectYear(1)">‡∏õ‡∏µ 1</button>
          <button class="year-tab" data-year="2" onclick="selectYear(2)">‡∏õ‡∏µ 2</button>
          <button class="year-tab" data-year="3" onclick="selectYear(3)">‡∏õ‡∏µ 3</button>
          <button class="year-tab" data-year="4" onclick="selectYear(4)">‡∏õ‡∏µ 4</button>
        </div>
        <div class="plan-section">
          <div class="plan-section-title">
            <span id="planLabel">üìÖ ‡∏õ‡∏µ 1 ‚Äî Study Plan</span>
            <button class="add-sem-btn" id="btnAddSemester">Ôºã Add Semester</button>
          </div>
          <div id="semesterList">
            <div class="empty-state"><div class="icon">üì≠</div><p>‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Add Subject -->
<div class="modal-overlay" id="subjectModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</div>
      <button class="modal-close" id="modalClose">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="section-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</div>
      <div class="field-row-3">
        <div class="field" style="grid-column:span 2">
          <label>‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ *</label>
          <input type="text" id="m_code" placeholder="‡πÄ‡∏ä‡πà‡∏ô 460-101" />
        </div>
        <div class="field">
          <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï *</label>
          <input type="number" id="m_credits" placeholder="3" min="1" max="9" />
        </div>
      </div>
      <div class="field-row">
        <div class="field">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢) *</label>
          <input type="text" id="m_name_th" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢" />
        </div>
        <div class="field">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label>
          <input type="text" id="m_name_en" placeholder="Subject Name (EN)" />
        </div>
      </div>
      <div class="field-row">
        <div class="field">
          <label>‡πÇ‡∏Ñ‡∏£‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</label>
          <input type="text" id="m_hours" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3(3-0-6)" />
        </div>
        <div class="field">
          <label>‡∏´‡∏°‡∏ß‡∏î‡∏ß‡∏¥‡∏ä‡∏≤</label>
          <select id="m_category">
            <option value="Core">Core Course (‡∏ß‡∏¥‡∏ä‡∏≤‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</option>
            <option value="Elective">Elective (‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</option>
            <option value="GE">GE (‡∏ß‡∏¥‡∏ä‡∏≤‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</option>
          </select>
        </div>
      </div>
      <div class="section-label">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</div>
      <div class="field-row">
        <div class="field">
          <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)</label>
          <textarea id="m_desc_th" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢..."></textarea>
        </div>
        <div class="field">
          <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label>
          <textarea id="m_desc_en" placeholder="Course description in English..."></textarea>
        </div>
      </div>
      <div class="section-label">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</div>
      <div class="field-row">
        <div class="field">
          <label>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)</label>
          <textarea id="m_out_th" placeholder="‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö..."></textarea>
        </div>
        <div class="field">
          <label>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label>
          <textarea id="m_out_en" placeholder="Learning outcomes after completing the course..."></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" id="modalCancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn-save" id="modalSave">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const BASE = "https://websitefms.onrender.com";
const API  = BASE + "/api";

if (!localStorage.getItem("user")) { window.location.href = "login.html"; }

document.getElementById("logoutBtn").addEventListener("click", (e) => {
  e.preventDefault();
  localStorage.removeItem("user");
  window.location.href = "login.html";
});

function toast(msg, type = "") {
  const el = document.getElementById("toast");
  el.textContent = msg; el.className = "toast show " + type;
  setTimeout(() => { el.className = "toast"; }, 2800);
}

let allMajors = [], allCourses = [], filtered = [];
let currentPage = 1, PAGE_SIZE = 6;
let selectedMajor = null;
let currentYear = 1;
let planId = null;
let planCache = {};

async function init() {
  try {
    allCourses = await fetch(`${API}/courses`).then(r => r.json());
    const sel = document.getElementById("courseFilter");
    allCourses.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c.id; opt.textContent = c.name_th || `Course #${c.id}`;
      sel.appendChild(opt);
    });
    const allMajorArrays = await Promise.all(
      allCourses.map(c => fetch(`${API}/courses/${c.id}/majors`).then(r => r.json()).catch(() => []))
    );
    allMajors = allMajorArrays.flatMap((majors, i) =>
      majors.map(m => ({ ...m, course_name: allCourses[i]?.name_th || "-", course_id: allCourses[i]?.id }))
    );
    applyFilter();
  } catch {
    document.getElementById("majorTableBody").innerHTML = `<div class="loading">‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</div>`;
  }
}

function applyFilter() {
  const q = (document.getElementById("searchInput").value + " " + document.getElementById("topSearch").value).trim().toLowerCase();
  const courseId = document.getElementById("courseFilter").value;
  filtered = allMajors.filter(m =>
    (!q || (m.name_th||"").toLowerCase().includes(q) || (m.name_en||"").toLowerCase().includes(q)) &&
    (!courseId || String(m.course_id) === courseId)
  );
  currentPage = 1; renderTable();
}

function renderTable() {
  const start = (currentPage - 1) * PAGE_SIZE;
  const page = filtered.slice(start, start + PAGE_SIZE);
  const tbody = document.getElementById("majorTableBody");
  if (!filtered.length) {
    tbody.innerHTML = `<div class="empty-state"><div class="icon">üîç</div><p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p></div>`;
    document.getElementById("footerInfo").textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
    document.getElementById("pagination").innerHTML = "";
    return;
  }
  tbody.innerHTML = page.map(m => `
    <div class="table-row ${selectedMajor?.id===m.id?'selected':''}" onclick="selectMajor(${m.id})">
      <div>
        <div class="major-name">${m.name_th||"-"}</div>
        <div class="major-en">${m.name_en||""}</div>
      </div>
      <div style="font-size:13px;color:var(--muted)">${m.course_name||"-"}</div>
      <div class="action-group" onclick="event.stopPropagation()">
        <button class="icon-btn edit" onclick="window.location.href='add-subject.html?majorId=1&courseId=1'" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‚úèÔ∏è</button>
        <button class="action-btn" title="‡∏•‡∏ö" onclick="deleteMajors(${m.id}, '${(m.name_th||'').replace(/'/g,"\\'")}')">üóëÔ∏è</button>
      </div>
    </div>`).join("");
  const total = filtered.length, totalPages = Math.ceil(total / PAGE_SIZE);
  document.getElementById("footerInfo").textContent = `‡πÅ‡∏™‡∏î‡∏á ${start+1} ‡∏ñ‡∏∂‡∏á ${Math.min(start+PAGE_SIZE,total)} ‡∏à‡∏≤‡∏Å ${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
  let pg = "";
  if (currentPage > 1) pg += `<button class="page-btn" onclick="gotoPage(${currentPage-1})">‚Äπ</button>`;
  for (let i=1; i<=totalPages; i++) pg += `<button class="page-btn ${i===currentPage?'active':''}" onclick="gotoPage(${i})">${i}</button>`;
  if (currentPage < totalPages) pg += `<button class="page-btn" onclick="gotoPage(${currentPage+1})">‚Ä∫</button>`;
  document.getElementById("pagination").innerHTML = pg;
}

function gotoPage(p) { currentPage = p; renderTable(); }

async function selectMajor(id) {
  const major = allMajors.find(m => m.id === id);
  if (!major) return;
  window.location.href = `add-subject.html?majorId=${major.id}&courseId=${major.course_id}`;
}

function selectYear(year) {
  currentYear = year; updateYearTabs();
  if (selectedMajor) loadPlanForYear(selectedMajor.id, year);
}

function updateYearTabs() {
  document.querySelectorAll(".year-tab").forEach(btn => {
    btn.classList.toggle("active", Number(btn.dataset.year) === currentYear);
  });
  document.getElementById("planLabel").textContent = `üìÖ ‡∏õ‡∏µ ${currentYear} ‚Äî Study Plan`;
}

async function loadPlanForYear(majorId, yearNo) {
  document.getElementById("semesterList").innerHTML = `<div class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>`;
  planId = null;
  try {
    const plans = await fetch(`${API}/majors/${majorId}/study-plans?page=1&pageSize=20`).then(r => r.json());
    const yearData = plans.data || [];
    const year = new Date().getFullYear() + 543;
    let plan = yearData.find(p => Number(p.year_no) === yearNo);
    if (!plan) {
      const created = await fetch(`${API}/majors/${majorId}/study-plans`, {
        method: "POST", headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ academic_year: year, year_no: yearNo, status: "active" })
      }).then(r => r.json());
      plan = created.plan;
    }
    if (!plan) {
      document.getElementById("semesterList").innerHTML = `<div class="empty-state"><div class="icon">üì≠</div><p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p></div>`;
      return;
    }
    planId = plan.id; planCache[yearNo] = planId;
    const detail = await fetch(`${API}/study-plans/${planId}`).then(r => r.json());
    renderSemesters(detail.semesters || [], yearNo);
  } catch {
    document.getElementById("semesterList").innerHTML = `<div class="empty-state"><div class="icon">‚ùå</div><p>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p></div>`;
  }
}

function renderSemesters(semesters, yearNo) {
  if (!semesters.length) {
    document.getElementById("semesterList").innerHTML =
      `<div class="empty-state"><div class="icon">üì≠</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô ‡∏õ‡∏µ ${yearNo}<br>‡∏Å‡∏î "+ Add Semester" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p></div>`;
    return;
  }
  document.getElementById("semesterList").innerHTML = semesters.map(sem => {
    const totalCred = (sem.subjects||[]).reduce((s,it) => s + Number(it.credits ?? it.default_credits ?? 0), 0);
    const subjectsHtml = (sem.subjects||[]).map(it => `
      <div class="subject-row">
        <div style="flex:1">
          <div class="subject-code">${it.code}</div>
          <div class="subject-name">${it.name_th}</div>
          <div class="subject-cat">${it.category||"Core"}</div>
        </div>
        <div style="display:flex;align-items:center;gap:4px">
          <span class="subject-credits">${it.credits??it.default_credits} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</span>
          <button class="subject-del" onclick="deleteSubject(${it.id})">üóë</button>
        </div>
      </div>`).join("");
    return `<div class="semester-block" id="sem_${sem.id}">
      <div class="semester-head" onclick="toggleSem(${sem.id})">
        <div class="semester-head-left">
          <span class="semester-name">${sem.title || `Semester ${sem.term_no}`}</span>
          <span class="credits-badge">${totalCred} Credits</span>
        </div>
        <span class="chevron">‚ñº</span>
      </div>
      <div class="semester-body">
        ${subjectsHtml || `<div style="padding:12px 14px;font-size:13px;color:var(--muted)">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</div>`}
        <div class="add-subject-row">
          <button class="add-subject-btn" onclick="openSubjectModal(${sem.id})">‚äï Add Subject</button>
        </div>
      </div>
    </div>`;
  }).join("");
}

function toggleSem(id) { document.getElementById("sem_"+id)?.classList.toggle("collapsed"); }

document.getElementById("closePanel").addEventListener("click", () => {
  document.getElementById("rightPanel").classList.remove("open");
  selectedMajor = null; planId = null; planCache = {};
  renderTable();
});

document.getElementById("btnAddSemester").addEventListener("click", async () => {
  if (!planId) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡πà‡∏≠‡∏ô", "error");
  try {
    const detail = await fetch(`${API}/study-plans/${planId}`).then(r => r.json());
    const existing = (detail.semesters||[]).map(s => Number(s.term_no));
    const next = [1,2,3].find(t => !existing.includes(t));
    if (!next) return toast("‡∏°‡∏µ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß", "error");
    const termNames = ["","‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà 1","‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà 2","‡∏†‡∏≤‡∏Ñ‡∏§‡∏î‡∏π‡∏£‡πâ‡∏≠‡∏ô"];
    const title = `‡∏õ‡∏µ ${currentYear} - ${termNames[next]}`;
    await fetch(`${API}/study-plans/${planId}/semesters`, {
      method: "POST", headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ term_no: next, title, sort_order: next })
    });
    toast(`‡πÄ‡∏û‡∏¥‡πà‡∏°${termNames[next]}‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úì`, "success");
    const d = await fetch(`${API}/study-plans/${planId}`).then(r => r.json());
    renderSemesters(d.semesters||[], currentYear);
  } catch { toast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "error"); }
});

let modalSemId = null;
function openSubjectModal(semId) {
  modalSemId = semId;
  ["m_code","m_name_th","m_name_en","m_credits","m_hours","m_desc_th","m_desc_en","m_out_th","m_out_en"]
    .forEach(id => { document.getElementById(id).value = ""; });
  document.getElementById("subjectModal").classList.add("open");
}
function closeModal() { document.getElementById("subjectModal").classList.remove("open"); }
document.getElementById("modalCancel").addEventListener("click", closeModal);
document.getElementById("modalClose").addEventListener("click", closeModal);
document.getElementById("subjectModal").addEventListener("click", e => { if (e.target === document.getElementById("subjectModal")) closeModal(); });

document.getElementById("m_code").addEventListener("blur", async () => {
  const code = document.getElementById("m_code").value.trim();
  if (!code) return;
  try {
    const items = await fetch(`${API}/subjects?query=${encodeURIComponent(code)}`).then(r => r.json());
    const found = items.find(it => it.code.toLowerCase() === code.toLowerCase());
    if (found) {
      document.getElementById("m_name_th").value = found.name_th || "";
      document.getElementById("m_name_en").value = found.name_en || "";
      document.getElementById("m_credits").value = found.default_credits || "";
      document.getElementById("m_hours").value   = found.default_hour_structure || "";
      document.getElementById("m_desc_th").value = found.description_th || "";
      document.getElementById("m_desc_en").value = found.description_en || "";
      document.getElementById("m_out_th").value  = found.outcomes_th || "";
      document.getElementById("m_out_en").value  = found.outcomes_en || "";
      toast("‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß ‚úì");
    }
  } catch {}
});

document.getElementById("modalSave").addEventListener("click", async () => {
  const code    = document.getElementById("m_code").value.trim();
  const name_th = document.getElementById("m_name_th").value.trim();
  const credits = Number(document.getElementById("m_credits").value);
  if (!code || !name_th || !credits) return toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤ / ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢ / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï", "error");
  let subject_id = null;
  try {
    const items = await fetch(`${API}/subjects?query=${encodeURIComponent(code)}`).then(r => r.json());
    const found = items.find(it => it.code.toLowerCase() === code.toLowerCase());
    if (found) subject_id = found.id;
  } catch {}
  const payload = { category: document.getElementById("m_category").value, credits, hour_structure: document.getElementById("m_hours").value.trim() || null };
  if (subject_id) { payload.subject_id = subject_id; }
  else {
    Object.assign(payload, {
      code, name_th, default_credits: credits,
      name_en: document.getElementById("m_name_en").value.trim() || null,
      default_hour_structure: document.getElementById("m_hours").value.trim() || null,
      description_th: document.getElementById("m_desc_th").value.trim() || null,
      description_en: document.getElementById("m_desc_en").value.trim() || null,
      outcomes_th: document.getElementById("m_out_th").value.trim() || null,
      outcomes_en: document.getElementById("m_out_en").value.trim() || null
    });
  }
  try {
    const res = await fetch(`${API}/semesters/${modalSemId}/subjects`, {
      method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error();
    toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úì", "success");
    closeModal();
    const d = await fetch(`${API}/study-plans/${planId}`).then(r => r.json());
    renderSemesters(d.semesters||[], currentYear);
  } catch { toast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "error"); }
});

async function deleteSubject(ssId) {
  if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ?")) return;
  try {
    await fetch(`${API}/semester-subjects/${ssId}`, { method: "DELETE" });
    toast("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "success");
    const d = await fetch(`${API}/study-plans/${planId}`).then(r => r.json());
    renderSemesters(d.semesters||[], currentYear);
  } catch { toast("‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "error"); }
}

document.getElementById("searchInput").addEventListener("input", applyFilter);
document.getElementById("topSearch").addEventListener("input", applyFilter);
document.getElementById("courseFilter").addEventListener("change", applyFilter);
init();
</script>
</body>
</html>