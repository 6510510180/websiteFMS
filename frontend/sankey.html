<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLO/MLO ‚Üî ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ‚Äî Sankey</title>
<link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@500;700&family=Sarabun:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#0d1117;color:#c9d1d9;font-family:'Sarabun',sans-serif;min-height:100vh}

header{padding:1.4rem 2rem 1rem;border-bottom:1px solid #21262d;background:linear-gradient(180deg,rgba(88,166,255,.06),transparent)}
h1{font-family:'Anuphan',sans-serif;font-size:1.6rem;font-weight:700;color:#e6edf3}
h1 em{color:#58a6ff;font-style:normal}
.sub{margin-top:.25rem;font-size:.85rem;color:#8b949e}

.bar{display:flex;align-items:center;flex-wrap:wrap;gap:.8rem;padding:1rem 2rem;background:#161b22;border-bottom:1px solid #21262d;overflow-x:auto}
.seg{display:flex;border:1px solid #30363d;border-radius:6px;overflow:hidden;flex-shrink:0}
.seg button{font-family:'Sarabun',sans-serif;font-size:.8rem;padding:.4rem 1rem;background:transparent;color:#8b949e;border:none;cursor:pointer;transition:all .15s;white-space:nowrap}
.seg button:not(:last-child){border-right:1px solid #30363d}
.seg button.on{background:rgba(88,166,255,.2);color:#58a6ff;font-weight:600}
.seg button:hover:not(.on){color:#c9d1d9;background:#21262d}

label{font-size:.8rem;color:#8b949e;flex-shrink:0}
select{font-family:'Sarabun',sans-serif;font-size:.8rem;padding:.4rem .8rem;background:#21262d;color:#c9d1d9;border:1px solid #30363d;border-radius:6px;outline:none;cursor:pointer;flex-shrink:0;min-width:140px}
select:focus{border-color:#58a6ff}

.hint{margin-left:auto;font-size:.72rem;color:#484f58;font-style:italic;flex-shrink:0}

#chart{padding:0;overflow:auto;background:#0d1117;border:1px solid #21262d;border-radius:8px;margin:1rem 2rem;min-height:600px}

svg{display:block}

#tt{position:fixed;background:#1c2128;border:1px solid #30363d;border-radius:8px;padding:.8rem 1rem;font-size:.8rem;pointer-events:none;opacity:0;transition:opacity .12s;z-index:999;max-width:300px;box-shadow:0 8px 24px rgba(0,0,0,.6);line-height:1.8}
.tt-h{color:#58a6ff;font-weight:700;margin-bottom:.3rem;font-size:.85rem}
.tt-s{color:#8b949e;font-size:.75rem}
.tt-v{color:#e6edf3;font-weight:600}

@media(max-width:768px){
  .bar{gap:.4rem}
  .seg button{padding:.3rem .6rem;font-size:.75rem}
  select{min-width:110px;font-size:.75rem;padding:.3rem .6rem}
  label{font-size:.75rem}
}
</style>
</head>
<body>

<header>
  <h1>üìä BBA 2567 ‚Äî <em>PLO / MLO ‚Üî ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</em></h1>
  <p class="sub">Sankey ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ (I = Intro ¬∑ R = Reinforce ¬∑ M = Mastery)</p>
</header>

<div class="bar">
  <div class="seg" id="dirSeg">
    <button class="on" onclick="setDir('plo2course',this)">PLO/MLO ‚Üí ‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</button>
    <button onclick="setDir('course2plo',this)">‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ ‚Üí PLO/MLO</button>
  </div>
  <label>üéì ‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏≠‡∏Å:</label>
  <select id="majorSel" onchange="render()">
    <option value="fin">üí∞ ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</option>
    <option value="mkt">üì¢ ‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£</option>
    <option value="hrm">üë• ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå</option>
    <option value="log">üì¶ ‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå‡πÅ‡∏•‡∏∞‡πÇ‡∏ã‡πà‡∏≠‡∏∏‡∏õ‡∏ó‡∏≤‡∏ô</option>
    <option value="bis">üíª ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</option>
    <option value="mice">üéâ ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡∏ã‡πå</option>
  </select>
  
  <label>üìö ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤:</label>
  <select id="groupSel" onchange="render()">
    <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
    <option value="ge">GE ¬∑ ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
    <option value="core">‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏Å‡∏ô</option>
    <option value="required">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</option>
    <option value="elective">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
  </select>

  <label>üéØ ‡πÅ‡∏™‡∏î‡∏á:</label>
  <select id="ploTypeSel" onchange="render()">
    <option value="plo">PLO ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (9)</option>
    <option value="mlo">MLO ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (14)</option>
    <option value="both">PLO + MLO (23)</option>
  </select>

  <div style="display:flex;align-items:center;gap:.4rem;margin-left:auto;flex-shrink:0">
    <span style="font-size:.75rem;color:#484f58">‡∏£‡∏∞‡∏î‡∏±‡∏ö:</span>
    <span style="display:flex;align-items:center;gap:.25rem;font-size:.7rem;padding:.2rem .5rem;border-radius:3px;background:#1c2128;border:1px solid #30363d">
      <span style="width:8px;height:8px;border-radius:1px;background:#484f58"></span>I
    </span>
    <span style="display:flex;align-items:center;gap:.25rem;font-size:.7rem;padding:.2rem .5rem;border-radius:3px;background:#1c2128;border:1px solid #30363d">
      <span style="width:8px;height:8px;border-radius:1px;background:#3d6b9e"></span>R
    </span>
    <span style="display:flex;align-items:center;gap:.25rem;font-size:.7rem;padding:.2rem .5rem;border-radius:3px;background:#1c2128;border:1px solid #30363d">
      <span style="width:8px;height:8px;border-radius:1px;background:#58a6ff"></span>M
    </span>
  </div>
</div>

<div id="chart"></div>
<div id="tt"></div>

<script>
const MC={fin:'#58a6ff',mkt:'#f78166',hrm:'#bc8cff',log:'#3fb950',bis:'#e3b341',mice:'#ff7b72'};
const PLO_C=['#f9826c','#f0883e','#e3b341','#85e89d','#56d364','#39d353','#58a6ff','#79c0ff','#bc8cff'];

const COURSES = {
  fin: [
    ['473-001G2','‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡∏£‡∏π‡πâ','ge',{PLO7:'I',PLO8:'R'}],
    ['460-101','‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î','core',{PLO1:'I',PLO2:'I',PLO3:'I'}],
    ['460-103','‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô','core',{PLO1:'I',PLO2:'I'}],
    ['464-101','‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô','core',{PLO1:'I',PLO9:'I'}],
    ['464-201','‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£','required',{PLO1:'R',PLO2:'R'}],
    ['473-200','‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô','required',{PLO1:'R',PLO2:'R'}],
    ['473-201','‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô','required',{PLO1:'I',PLO2:'I',PLO4:'I'}],
    ['473-202','‡∏™‡∏ñ‡∏≤‡∏ö‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô','required',{PLO1:'I',PLO2:'I'}],
    ['473-300','‡∏ï‡∏£‡∏≤‡∏™‡∏≤‡∏£‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô','required',{PLO1:'R',PLO2:'R'}],
    ['473-301','‡∏à‡∏£‡∏£‡∏¢‡∏≤‡∏ö‡∏£‡∏£‡∏ì‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û','required',{PLO1:'R',PLO4:'R'}],
    ['473-302','‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏û‡∏±‡∏ô‡∏ò‡πå','required',{PLO1:'M',PLO2:'R'}],
    ['473-303','‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô 1','required',{PLO1:'R',PLO2:'R'}],
    ['473-304','‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô','required',{PLO1:'R',PLO2:'R',PLO5:'R'}],
    ['473-305','‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô','required',{PLO1:'R',PLO5:'R'}],
    ['460-402','‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏´‡∏Å‡∏¥‡∏à','required',{PLO1:'M',PLO2:'M'}],
    ['460-403','‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤','required',{PLO1:'M',PLO2:'M',PLO5:'M'}],
    ['473-306','‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì','elective',{PLO1:'I',PLO4:'I'}],
    ['473-307','‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô','elective',{PLO1:'R',PLO4:'R'}],
    ['473-402','‡∏†‡∏≤‡∏©‡∏µ‡πÅ‡∏•‡∏∞‡∏°‡∏£‡∏î‡∏Å','elective',{PLO1:'R',PLO6:'R'}],
  ],
  mkt: [
    ['460-101','‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î','core',{PLO1:'I',PLO2:'I',PLO3:'I'}],
    ['474-101','‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ','required',{PLO1:'I',PLO2:'I'}],
    ['474-201','‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå','required',{PLO1:'I',PLO2:'I',PLO3:'I'}],
    ['474-202','‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î','required',{PLO1:'I',PLO3:'I'}],
    ['474-203','‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏™‡∏±‡∏á‡∏Ñ‡∏°','required',{PLO1:'I',PLO3:'I',PLO9:'I'}],
    ['474-204','‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏£‡∏≤‡∏Ñ‡∏≤','required',{PLO1:'I',PLO2:'I'}],
    ['474-301','Omnichannel','required',{PLO1:'R',PLO2:'R',PLO5:'M'}],
    ['474-302','‡∏ß‡∏±‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î','required',{PLO1:'R',PLO2:'R'}],
    ['474-303','‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î','required',{PLO1:'M',PLO2:'R'}],
    ['474-304','‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô','required',{PLO1:'R',PLO2:'R',PLO5:'R'}],
    ['474-305','IMC','required',{PLO1:'R',PLO2:'M',PLO3:'M'}],
    ['474-306','‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•','required',{PLO1:'M',PLO5:'M'}],
    ['460-403','‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤','required',{PLO1:'M',PLO2:'M',PLO5:'M'}],
    ['474-401','‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î','required',{PLO1:'M',PLO2:'M'}],
    ['474-307','‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£','elective',{PLO1:'R',PLO3:'R'}],
  ],
  hrm: [
    ['475-201','‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô HRM','required',{PLO1:'I',PLO2:'I'}],
    ['475-202','‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£','required',{PLO1:'I',PLO4:'I'}],
    ['475-203','‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥','required',{PLO1:'R',PLO2:'R'}],
    ['475-204','‡∏û‡∏±‡∏í‡∏ô‡∏≤ HRM','required',{PLO1:'R',PLO2:'R'}],
    ['475-205','‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô','required',{PLO1:'R',PLO2:'R'}],
    ['475-300','‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô','required',{PLO1:'R',PLO4:'M'}],
    ['475-301','‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û','required',{PLO1:'R',PLO2:'R'}],
    ['475-302','‡πÄ‡∏à‡∏£‡∏à‡∏≤/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á','required',{PLO1:'R',PLO3:'R'}],
    ['475-303','‡∏ß‡∏¥‡∏à‡∏±‡∏¢ HRM','required',{PLO1:'R',PLO2:'R'}],
    ['475-304','‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ HRM','required',{PLO4:'R',PLO9:'R'}],
    ['460-403','‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤','required',{PLO1:'M',PLO2:'M',PLO5:'M'}],
    ['475-402','‡∏™‡∏±‡∏°‡∏°‡∏ô‡∏≤ HRM','required',{PLO2:'R',PLO4:'M'}],
    ['475-421','HR ‡πÄ‡∏ä‡∏¥‡∏á‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå','elective',{PLO1:'M',PLO2:'M'}],
  ],
  log: [
    ['476-201','‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô','required',{PLO1:'I',PLO2:'I'}],
    ['476-202','‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®','required',{PLO1:'I',PLO5:'I'}],
    ['476-203','‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á','required',{PLO1:'I',PLO2:'I'}],
    ['476-204','‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠','required',{PLO1:'I',PLO2:'I'}],
    ['476-300','‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô','required',{PLO1:'M',PLO2:'M'}],
    ['476-301','‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤','required',{PLO1:'M',PLO2:'M'}],
    ['476-302','‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á','required',{PLO1:'M',PLO2:'M'}],
    ['476-303','‡∏ï‡∏±‡∏ß‡πÅ‡∏ö‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°','required',{PLO1:'M',PLO5:'M'}],
    ['476-304','‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å-‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤','required',{PLO1:'M',PLO2:'M'}],
    ['476-305','‡∏ß‡∏¥‡∏ò‡∏µ‡∏ß‡∏¥‡∏à‡∏±‡∏¢','required',{PLO2:'M',PLO5:'M'}],
    ['460-403','‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤','required',{PLO1:'M',PLO2:'M',PLO5:'M'}],
    ['476-401','‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏ã‡πà‡∏≠‡∏∏‡∏õ‡∏ó‡∏≤‡∏ô','required',{PLO1:'R',PLO5:'M'}],
  ],
  bis: [
    ['460-202','‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞','core',{PLO2:'I',PLO5:'I'}],
    ['477-101','‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ IS','required',{PLO1:'I',PLO5:'I'}],
    ['477-102','‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°','required',{PLO2:'I',PLO5:'I'}],
    ['477-201','‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°','required',{PLO2:'I',PLO5:'I'}],
    ['477-202','‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢+Cyber','required',{PLO2:'I',PLO5:'I'}],
    ['477-203','‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•','required',{PLO2:'I',PLO5:'I'}],
    ['477-204','Cloud','required',{PLO2:'I',PLO5:'R'}],
    ['477-301','Full-stack Web','required',{PLO2:'R',PLO5:'R'}],
    ['477-302','‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏∞‡∏ö‡∏ö','required',{PLO1:'R',PLO2:'R',PLO5:'R'}],
    ['477-303','MIS','required',{PLO1:'R',PLO2:'R',PLO5:'R'}],
    ['477-304','‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô','required',{PLO2:'R',PLO5:'M'}],
    ['460-403','‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤','required',{PLO1:'M',PLO2:'M',PLO5:'M'}],
    ['477-306','AI/ML','elective',{PLO2:'R',PLO5:'R'}],
  ],
  mice: [
    ['478-200','‡πÑ‡∏°‡∏ã‡πå‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô','required',{PLO1:'I',PLO3:'I'}],
    ['478-201','‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÑ‡∏°‡∏ã‡πå','required',{PLO3:'I',PLO6:'R'}],
    ['478-202','‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£','required',{PLO1:'R',PLO3:'I'}],
    ['478-203','‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•','required',{PLO1:'R',PLO3:'I'}],
    ['478-205','‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠','required',{PLO3:'R'}],
    ['478-301','‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û','required',{PLO1:'R',PLO3:'R'}],
    ['478-302','‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå','required',{PLO1:'R',PLO2:'M',PLO3:'R'}],
    ['478-303','‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤','required',{PLO1:'R',PLO2:'M'}],
    ['478-304','‡∏ú‡∏•‡∏¥‡∏ï‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå','required',{PLO3:'R',PLO5:'R'}],
    ['478-305','‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô','required',{PLO1:'R',PLO3:'R'}],
    ['460-402','‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏´‡∏Å‡∏¥‡∏à','required',{PLO1:'M'}],
    ['460-403','‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤','required',{PLO1:'M',PLO2:'M'}],
    ['478-401','‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà','required',{PLO1:'M',PLO3:'R'}],
    ['478-306','‡∏ï‡∏•‡∏≤‡∏î‡πÑ‡∏°‡∏ã‡πå','elective',{PLO2:'R',PLO3:'M'}],
  ],
};

const PLO_INFO = Array.from({length:9}, (_, i)=>({id:`PLO${i+1}`, name:`PLO${i+1}`, full:`PLO${i+1}`}));

let dir = 'plo2course';

function setDir(d,btn){
  dir = d;
  document.querySelectorAll('#dirSeg button').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  render();
}

function buildGraph(){
  const mid = document.getElementById('majorSel').value;
  const grpSel = document.getElementById('groupSel').value;
  const ploType = document.getElementById('ploTypeSel').value;
  
  let courses = (COURSES[mid]||[]).slice();
  if(grpSel !== 'all') courses = courses.filter(c => c[2] === grpSel);

  const usedPLO = new Set();
  courses.forEach(c => Object.keys(c[3]||{}).forEach(k => usedPLO.add(k)));
  const ploNodes = PLO_INFO.filter(p => ploType==='plo'||ploType==='both' ? true : false).concat(
    ploType==='mlo'||ploType==='both' ? [] : []
  ).filter(p => usedPLO.has(p.id));

  const rawNodes = [];
  const nm = {};
  const add = (id,label,col,color,meta={})=>{
    nm[id] = rawNodes.length;
    rawNodes.push({id,label,col,color,...meta});
  };

  if(dir === 'plo2course'){
    ploNodes.forEach((p,i) => add(p.id, p.name, 0, PLO_C[i%PLO_C.length], {kind:'plo'}));
    courses.forEach(c => add('c_'+c[0], c[0], 1, MC[mid], {kind:'course', code:c[0], name:c[1], group:c[2], map:c[3]}));
  } else {
    courses.forEach(c => add('c_'+c[0], c[0], 0, MC[mid], {kind:'course', code:c[0], name:c[1], group:c[2], map:c[3]}));
    ploNodes.forEach((p,i) => add(p.id, p.name, 1, PLO_C[i%PLO_C.length], {kind:'plo'}));
  }

  const rawLinks = [];
  const LEVEL_VAL = {I:1, R:2, M:3};

  courses.forEach(c => {
    const cid = 'c_'+c[0];
    Object.entries(c[3]||{}).forEach(([pkey, lv]) => {
      if(!(pkey in nm)) return;
      const pi = ploNodes.findIndex(p => p.id === pkey);
      const pc = PLO_C[pi%PLO_C.length]||'#58a6ff';
      const v = LEVEL_VAL[lv]||1;
      if(dir === 'plo2course'){
        rawLinks.push({s:nm[pkey], t:nm[cid], v, lv, color:pc});
      } else {
        rawLinks.push({s:nm[cid], t:nm[pkey], v, lv, color:MC[mid]});
      }
    });
  });

  const linkMap = {};
  rawLinks.forEach(l => {
    const k = `${l.s}:${l.t}`;
    if(linkMap[k]) linkMap[k].v += l.v;
    else linkMap[k] = {...l};
  });

  return {rawNodes, links: Object.values(linkMap)};
}

function render(){
  const container = document.getElementById('chart');
  container.innerHTML = '';
  
  const {rawNodes, links} = buildGraph();
  const mid = document.getElementById('majorSel').value;
  
  const W = Math.max(800, container.clientWidth - 4);
  const H = Math.max(600, window.innerHeight - 250);

  const margin = {l:180, r:160, t:40, b:20};
  const iW = W - margin.l - margin.r;
  const iH = H - margin.t - margin.b;

  const nodeW = 24;
  const pad = 12;
  const colNodes = {};
  rawNodes.forEach(n => {
    colNodes[n.col] = colNodes[n.col]||[];
    colNodes[n.col].push(n);
  });
  
  // Position nodes
  const gap = (iW - nodeW) / Math.max(Object.keys(colNodes).length - 1, 1);
  Object.keys(colNodes).forEach(col => {
    const col_n = colNodes[col];
    const sumV = col_n.reduce((a,n)=>a+Math.max(n.v||1, 1), 0);
    const scale = (iH - pad*(col_n.length-1)) / Math.max(sumV, 1);
    let y = 0;
    col_n.forEach(n => {
      n.x0 = col*gap;
      n.x1 = n.x0 + nodeW;
      n.h = Math.max((n.v||1)*scale, 3);
      n.y0 = y;
      n.y1 = y + n.h;
      y += n.h + pad;
    });
  });

  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('width', W);
  svg.setAttribute('height', H);
  container.appendChild(svg);

  const g = document.createElementNS('http://www.w3.org/2000/svg','g');
  g.setAttribute('transform', `translate(${margin.l},${margin.t})`);
  svg.appendChild(g);

  // Draw links
  links.forEach(l => {
    const src = rawNodes[l.s];
    const tgt = rawNodes[l.t];
    const sy = src.y0 + (src.y1-src.y0)/2;
    const ty = tgt.y0 + (tgt.y1-tgt.y0)/2;
    const mx = (src.x1 + tgt.x0) / 2;

    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    const d = `M${src.x1},${sy} C${mx},${sy} ${mx},${ty} ${tgt.x0},${ty}`;
    path.setAttribute('d', d);
    path.setAttribute('fill', 'none');
    path.setAttribute('stroke', l.color||'#58a6ff');
    path.setAttribute('stroke-width', Math.max(1, l.v));
    path.setAttribute('stroke-opacity', 0.4);
    path.style.cursor = 'pointer';
    
    const lv_label = {I:'Intro',R:'Reinforce',M:'Mastery'};
    path.addEventListener('mouseover', e => {
      path.setAttribute('stroke-opacity', 0.8);
      showTip(e, `<div class="tt-h">${rawNodes[l.s].label} ‚Üí ${rawNodes[l.t].label}</div><div class="tt-s">‡∏£‡∏∞‡∏î‡∏±‡∏ö: <span class="tt-v">${lv_label[l.lv]}</span></div>`);
    });
    path.addEventListener('mousemove', moveTip);
    path.addEventListener('mouseout', e => {
      path.setAttribute('stroke-opacity', 0.4);
      hideTip();
    });

    g.appendChild(path);
  });

  // Draw nodes
  rawNodes.forEach(n => {
    const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('x', n.x0);
    rect.setAttribute('y', n.y0);
    rect.setAttribute('width', n.x1-n.x0);
    rect.setAttribute('height', Math.max(n.h, 3));
    rect.setAttribute('fill', n.color||'#58a6ff');
    rect.setAttribute('rx', '3');
    
    rect.addEventListener('mouseover', e => {
      rect.setAttribute('fill-opacity', '0.8');
      let tip = `<div class="tt-h">${n.label}</div>`;
      if(n.kind==='course') tip += `<div class="tt-s">${n.name}</div><div class="tt-s">‡∏Å‡∏•‡∏∏‡πà‡∏°: ${n.group}</div>`;
      showTip(e, tip);
    });
    rect.addEventListener('mousemove', moveTip);
    rect.addEventListener('mouseout', e => {
      rect.removeAttribute('fill-opacity');
      hideTip();
    });

    g.appendChild(rect);

    const isLeft = n.col === 0;
    const lbl = document.createElementNS('http://www.w3.org/2000/svg','text');
    lbl.setAttribute('x', isLeft ? n.x0-8 : n.x1+8);
    lbl.setAttribute('y', (n.y0+n.y1)/2);
    lbl.setAttribute('dy', '0.35em');
    lbl.setAttribute('text-anchor', isLeft?'end':'start');
    lbl.setAttribute('font-size', '11');
    lbl.setAttribute('fill', isLeft?'#c9d1d9':'#8b949e');
    lbl.setAttribute('pointer-events', 'none');
    lbl.textContent = n.label.length > 20 ? n.label.slice(0,20)+'‚Ä¶' : n.label;
    g.appendChild(lbl);
  });
}

const TT = document.getElementById('tt');
function showTip(e, html){
  TT.innerHTML = html;
  TT.style.opacity = '1';
  TT.style.left = (e.clientX+14)+'px';
  TT.style.top = (e.clientY-10)+'px';
}
function moveTip(e){
  TT.style.left = (e.clientX+14)+'px';
  TT.style.top = (e.clientY-10)+'px';
}
function hideTip(){
  TT.style.opacity = '0';
}

render();
window.addEventListener('resize', render);
</script>

</body>
</html>