<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard | FMS Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&family=Lexend:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --purple:#6B3FA0;--purple-dark:#4A2870;--purple-light:#F3EEFF;--purple-mid:#E8DEFF;
      --accent:#9B6DD1;--bg:#F7F5FA;--white:#FFFFFF;--text:#181117;--text-sub:#64748B;
      --border:#EDE8F5;--red:#EF4444;--red-bg:#FEE2E2;--sidebar-w:240px;--topbar-h:64px;
      --radius:12px;--shadow:0 1px 3px rgba(0,0,0,0.07),0 1px 2px rgba(0,0,0,0.04);
      --shadow-md:0 4px 12px rgba(107,63,160,0.10);
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Noto Sans Thai','Lexend',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh;}
    svg{display:block;}

    /* SIDEBAR */
    .sidebar{width:var(--sidebar-w);background:var(--white);height:100vh;position:fixed;left:0;top:0;display:flex;flex-direction:column;border-right:1px solid var(--border);z-index:100;}
    .sidebar-brand{padding:20px 20px 16px;border-bottom:1px solid var(--border);}
    .sidebar-brand-title{font-family:'Lexend',sans-serif;font-size:16px;font-weight:700;color:var(--text);letter-spacing:-0.2px;}
    .sidebar-brand-sub{font-size:11.5px;color:var(--purple);font-weight:500;margin-top:2px;}
    .sidebar-section-label{padding:20px 20px 6px;font-size:10px;font-weight:700;color:var(--text-sub);text-transform:uppercase;letter-spacing:1.2px;}
    .sidebar-nav{flex:1;padding:8px 12px;display:flex;flex-direction:column;gap:2px;overflow-y:auto;}
    .nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;font-size:13.5px;font-weight:500;color:var(--text-sub);text-decoration:none;transition:all 0.18s;cursor:pointer;user-select:none;}
    .nav-item:hover{background:var(--purple-light);color:var(--purple);}
    .nav-item.active{background:var(--purple-light);color:var(--purple);font-weight:600;}
    .nav-icon{width:18px;height:18px;flex-shrink:0;opacity:0.75;}
    .nav-item.active .nav-icon,.nav-item:hover .nav-icon{opacity:1;}
    .sidebar-footer{padding:12px;border-top:1px solid var(--border);}
    .sidebar-footer .nav-item{color:var(--red);}
    .sidebar-footer .nav-item:hover{background:var(--red-bg);color:#DC2626;}

    /* TOPBAR */
    .topbar{position:fixed;top:0;left:var(--sidebar-w);right:0;height:var(--topbar-h);background:var(--white);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 32px;z-index:90;}
    .topbar-left{display:flex;flex-direction:column;}
    .topbar-title{font-family:'Lexend',sans-serif;font-size:16px;font-weight:700;color:var(--text);letter-spacing:-0.2px;}
    .topbar-breadcrumb{font-size:11.5px;color:var(--text-sub);margin-top:1px;}
    .topbar-right{display:flex;align-items:center;gap:14px;}
    .search-wrap{display:flex;align-items:center;gap:8px;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:7px 14px;width:220px;transition:border-color 0.15s;}
    .search-wrap:focus-within{border-color:var(--accent);}
    .search-wrap input{border:none;background:none;outline:none;font-size:13px;color:var(--text);font-family:inherit;width:100%;}
    .search-wrap input::placeholder{color:var(--text-sub);}
    .avatar-wrap{display:flex;align-items:center;gap:10px;cursor:pointer;padding:6px 10px;border-radius:8px;transition:background 0.15s;}
    .avatar-wrap:hover{background:var(--purple-light);}
    .avatar-name{font-size:13px;font-weight:600;color:var(--purple);}
    .avatar-circle{width:34px;height:34px;border-radius:50%;background:var(--purple-mid);border:2px solid var(--purple-light);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--purple);}

    /* MAIN */
    .main{margin-left:var(--sidebar-w);padding-top:var(--topbar-h);flex:1;min-width:0;}
    .page-body{padding:32px;display:flex;flex-direction:column;gap:24px;}

    /* Page header */
    .page-header-row{display:flex;align-items:center;justify-content:space-between;gap:16px;}
    .page-heading-wrap{display:flex;flex-direction:column;gap:4px;}
    .page-heading{font-family:'Lexend',sans-serif;font-size:26px;font-weight:800;color:var(--purple);letter-spacing:-0.4px;line-height:1.2;}
    .page-sub{font-size:14px;color:var(--text-sub);}
    .add-btn{display:flex;align-items:center;gap:8px;padding:10px 22px;background:var(--purple);color:var(--white);border:none;border-radius:10px;font-size:14px;font-weight:700;font-family:inherit;cursor:pointer;white-space:nowrap;box-shadow:0 4px 12px rgba(107,63,160,0.30);transition:all 0.18s;}
    .add-btn:hover{background:var(--purple-dark);transform:translateY(-1px);}

    /* Stat cards */
    .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
    .stat-card{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);padding:22px 24px;box-shadow:var(--shadow);transition:all 0.2s;position:relative;overflow:hidden;}
    .stat-card::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--purple);transform:scaleX(0);transition:transform 0.2s;transform-origin:left;}
    .stat-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
    .stat-card:hover::after{transform:scaleX(1);}
    .stat-label{font-size:12px;font-weight:600;color:var(--text-sub);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:10px;}
    .stat-number{font-family:'Lexend',sans-serif;font-size:36px;font-weight:800;color:var(--purple);line-height:1;}
    .stat-icon{position:absolute;right:20px;top:20px;width:40px;height:40px;border-radius:10px;background:var(--purple-light);display:flex;align-items:center;justify-content:center;color:var(--purple);}

    /* Charts */
    .chart-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
    .chart-card{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);padding:22px 24px;box-shadow:var(--shadow);}
    .chart-card-title{font-family:'Lexend',sans-serif;font-size:15px;font-weight:700;color:var(--text);margin-bottom:4px;}
    .chart-card-sub{font-size:12px;color:var(--text-sub);margin-bottom:18px;}

    /* Table */
    .table-card{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;}
    .table-card-header{padding:16px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
    .table-card-title{font-family:'Lexend',sans-serif;font-size:15px;font-weight:700;color:var(--text);}
    .table-card-link{font-size:13px;font-weight:600;color:var(--purple);cursor:pointer;text-decoration:none;}
    .table-card-link:hover{opacity:0.7;}
    table{width:100%;border-collapse:collapse;}
    thead tr{background:var(--bg);}
    th{padding:11px 20px;text-align:left;font-size:11px;font-weight:700;color:var(--text-sub);text-transform:uppercase;letter-spacing:0.8px;border-bottom:1px solid var(--border);}
    td{padding:13px 20px;font-size:14px;border-bottom:1px solid var(--border);vertical-align:middle;}
    tr:last-child td{border-bottom:none;}
    tbody tr{transition:background 0.1s;}
    tbody tr:hover{background:var(--purple-light);}
    .course-link{color:var(--purple);font-weight:600;cursor:pointer;}
    .course-link:hover{text-decoration:underline;}
    .status-badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:600;}
    .status-active{background:#DCFCE7;color:#16A34A;}
    .status-draft{background:var(--purple-light);color:var(--purple);}
    .status-maintenance{background:#FEF3C7;color:#D97706;}
    .action-btn{padding:6px 16px;border-radius:8px;font-size:12px;font-weight:600;border:1.5px solid var(--border);background:var(--white);color:var(--text-sub);cursor:pointer;font-family:inherit;transition:all 0.15s;}
    .action-btn:hover{border-color:var(--purple);color:var(--purple);background:var(--purple-light);}
  </style>
</head>
<body>

<aside class="sidebar">
  <div class="sidebar-brand">
    <div class="sidebar-brand-title">FMS Admin</div>
    <div class="sidebar-brand-sub">PSU Faculty of Management</div>
  </div>
  <div class="sidebar-section-label">เมนูหลัก</div>
  <nav class="sidebar-nav">
    <a class="nav-item active" href="dashboard.html">
      <svg class="nav-icon" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"/></svg>
      แดชบอร์ด
    </a>
    <a class="nav-item" href="study-plan.html">
      <svg class="nav-icon" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/></svg>
      แผนการศึกษา
    </a>
    <a class="nav-item" href="course-list.html">
      <svg class="nav-icon" viewBox="0 0 20 20" fill="currentColor"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/></svg>
      หลักสูตร
    </a>
    <a class="nav-item" href="qa-dashboard.html">
      <svg class="nav-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
      ประกันคุณภาพการศึกษา
    </a>
  </nav>
  <div class="sidebar-footer">
    <a class="nav-item" href="login.html" id="logoutBtn">
      <svg class="nav-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/></svg>
      ออกจากระบบ
    </a>
  </div>
</aside>

<header class="topbar">
  <div class="topbar-left">
    <div class="topbar-title">แดชบอร์ด</div>
    <div class="topbar-breadcrumb">คณะวิทยาการจัดการ · PSU</div>
  </div>
  <div class="topbar-right">
    <div class="search-wrap">
      <svg width="15" height="15" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="8.5" cy="8.5" r="5.5"/><path d="M15 15l-3.5-3.5"/></svg>
      <input type="text" placeholder="ค้นหารายวิชา..." />
    </div>
    <div class="avatar-wrap">
      <div class="avatar-name">Administrator</div>
      <div class="avatar-circle">A</div>
    </div>
  </div>
</header>

<main class="main">
  <div class="page-body">

    <div class="page-header-row">
      <div class="page-heading-wrap">
        <div class="page-heading">ภาพรวมระบบ</div>
        <div class="page-sub">ข้อมูลสรุปหลักสูตรและสถิติการใช้งานระบบ FMS Admin</div>
      </div>
      <button class="add-btn" id="addCourseBtn">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"/></svg>
        เพิ่มหลักสูตรใหม่
      </button>
    </div>

    <div class="cards">
      <div class="stat-card">
        <div class="stat-icon">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z"/></svg>
        </div>
        <div class="stat-label">หลักสูตรทั้งหมด</div>
        <div class="stat-number" id="totalCourses">—</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:#DCFCE7;color:#16A34A;">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
        </div>
        <div class="stat-label">ใช้งานอยู่ (Active)</div>
        <div class="stat-number" id="activeCourses" style="color:#16A34A;">—</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:#FEF3C7;color:#D97706;">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
        </div>
        <div class="stat-label">ปิดปรับปรุง (Maintenance)</div>
        <div class="stat-number" id="maintenance" style="color:#D97706;">—</div>
      </div>
    </div>

    <div class="chart-row">
      <div class="chart-card">
        <div class="chart-card-title">จำนวนผู้เข้าชมเว็บไซต์</div>
        <div class="chart-card-sub">หลักสูตรบริหารธุรกิจบัณฑิต · ประจำปีการศึกษา 2567</div>
        <canvas id="chart1"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-card-title">ความนิยมสาขาวิชา (Popularity)</div>
        <div class="chart-card-sub">แยกตามหมวดหมู่สาขาวิชา</div>
        <canvas id="chart2"></canvas>
      </div>
    </div>

    <div class="table-card">
      <div class="table-card-header">
        <div class="table-card-title">หลักสูตรใหม่ล่าสุด</div>
        <a class="table-card-link" href="course-list.html">ดูทั้งหมด →</a>
      </div>
      <table>
        <thead>
          <tr>
            <th>ชื่อหลักสูตร</th><th>ระดับการศึกษา</th><th>วันที่เพิ่ม</th><th>สถานะ</th><th>จัดการ</th>
          </tr>
        </thead>
        <tbody id="courseTable">
          <tr><td colspan="5" style="text-align:center;color:var(--text-sub);padding:32px;">⏳ กำลังโหลด...</td></tr>
        </tbody>
      </table>
    </div>

  </div>
</main>

<script>
const BASE_URL="https://websitefms.onrender.com";const API=BASE_URL+"/api";
if(!localStorage.getItem("user")){window.location.href="login.html";}
document.getElementById("logoutBtn").addEventListener("click",e=>{e.preventDefault();localStorage.removeItem("user");window.location.href="login.html";});
document.getElementById("addCourseBtn").addEventListener("click",()=>{window.location.href="add-course.html";});
async function loadDashboard(){
  try{
    const res=await fetch(API+"/courses");const courses=await res.json();
    if(!res.ok)throw new Error();
    document.getElementById("totalCourses").textContent=courses.length;
    document.getElementById("activeCourses").textContent=courses.filter(c=>c.status==="active").length;
    document.getElementById("maintenance").textContent=courses.filter(c=>c.status==="maintenance").length;
    const latest=[...courses].sort((a,b)=>b.id-a.id).slice(0,3);
    const today=new Date().toLocaleDateString("th-TH");
    document.getElementById("courseTable").innerHTML=latest.map(c=>{
      const sc=c.status==="active"?"status-active":c.status==="maintenance"?"status-maintenance":"status-draft";
      return`<tr><td><span class="course-link" onclick="viewCourse(${c.id})">${c.name_th||"-"}</span></td><td style="color:var(--text-sub)">${c.degree_level||"-"}</td><td style="color:var(--text-sub)">${today}</td><td><span class="status-badge ${sc}">${c.status||"-"}</span></td><td><button class="action-btn" onclick="viewCourse(${c.id})">View</button></td></tr>`;
    }).join("");
  }catch{document.getElementById("courseTable").innerHTML=`<tr><td colspan="5" style="text-align:center;color:var(--red);padding:24px;">โหลดข้อมูลไม่ได้</td></tr>`;}
}
function viewCourse(id){window.location.href=`course-info.html?courseId=${id}`;}
new Chart(document.getElementById("chart1"),{type:"bar",data:{labels:["ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],datasets:[{label:"ผู้เข้าชม",data:[710,670,590,640,730,800],backgroundColor:"#6B3FA0",borderColor:"transparent",borderWidth:0,borderRadius:8,borderSkipped:false}]},options:{maintainAspectRatio:true,aspectRatio:1.7,plugins:{legend:{display:false}},scales:{x:{grid:{display:false},ticks:{font:{family:"'Noto Sans Thai'",size:13},color:"#64748B"}},y:{grid:{color:"#EDE8F5"},ticks:{font:{family:"'Noto Sans Thai'",size:12},color:"#64748B"},beginAtZero:true}}}});
const d2Labels=["บริหารธุรกิจ","การเงิน","การตลาด","บัญชี","รัฐประศาสน์"];
const d2Data=[35,20,22,15,8];
const d2Colors=["#6B3FA0","#9B6DD1","#A78BCA","#3B82F6","#10B981"];
new Chart(document.getElementById("chart2"),{
  type:"doughnut",
  data:{labels:d2Labels,datasets:[{data:d2Data,backgroundColor:d2Colors,borderWidth:3,borderColor:"#fff",hoverOffset:6}]},
  options:{
    maintainAspectRatio:true,
    aspectRatio:1.7,
    cutout:"55%",
    plugins:{
      legend:{
        position:"right",
        labels:{
          font:{family:"'Noto Sans Thai',sans-serif",size:12},
          padding:14,
          usePointStyle:true,
          pointStyleWidth:10,
          generateLabels:function(chart){
            return chart.data.labels.map((label,i)=>({
              text:label+"  "+d2Data[i]+"%",
              fillStyle:d2Colors[i],
              strokeStyle:d2Colors[i],
              fontColor:d2Colors[i],
              hidden:false,
              index:i
            }));
          }
        }
      },
      tooltip:{callbacks:{label:function(ctx){return " "+ctx.label+": "+ctx.parsed+"%";}}}
    }
  }
});
loadDashboard();
</script>
</body>
</html>